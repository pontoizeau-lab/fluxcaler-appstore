{
  "services": [
    {
      "name": "fluxcaler-mongodb",
      "image": "mongo:latest",
      "internalPort": 27017,
      "isMain": false,
      "environment": [
        "MONGO_INITDB_ROOT_USERNAME=${MONGO_ROOT_USER}",
        "MONGO_INITDB_ROOT_PASSWORD=${MONGO_ROOT_PASSWORD}",
        "MONGO_INITDB_DATABASE=${MONGO_DATABASE}"
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/db",
          "containerPath": "/data/db"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/configdb",
          "containerPath": "/data/configdb"
        }
      ],
      "healthCheck": {
        "test": "mongosh --eval 'db.adminCommand(\"ping\")' --quiet",
        "interval": "30s",
        "timeout": "10s",
        "retries": 5
      },
      "addPorts": [
        {
          "containerPort": 27017,
          "hostPort": 27018,
          "protocol": "tcp"
        }
      ]
    },
    {
      "name": "fluxcaler-mongo-express",
      "image": "mongo-express:latest",
      "internalPort": 8081,
      "isMain": true,
      "dependsOn": [
        "fluxcaler-mongodb"
      ],
      "environment": [
        "ME_CONFIG_MONGODB_ADMINUSERNAME=${MONGO_ROOT_USER}",
        "ME_CONFIG_MONGODB_ADMINPASSWORD=${MONGO_ROOT_PASSWORD}",
        "ME_CONFIG_MONGODB_URL=mongodb://${MONGO_ROOT_USER}:${MONGO_ROOT_PASSWORD}@fluxcaler-mongodb:27017/",
        "ME_CONFIG_BASICAUTH_USERNAME=${ME_BASIC_AUTH_USERNAME}",
        "ME_CONFIG_BASICAUTH_PASSWORD=${ME_BASIC_AUTH_PASSWORD}",
        "ME_CONFIG_MONGODB_ENABLE_ADMIN=true"
      ],
      "healthCheck": {
        "test": "wget --no-verbose --tries=1 --spider http://localhost:8081 || exit 1",
        "interval": "30s",
        "timeout": "10s",
        "retries": 3
      },
      "addPorts": [
        {
          "containerPort": 8081,
          "hostPort": 8082,
          "protocol": "tcp"
        }
      ]
    }
  ]
}
